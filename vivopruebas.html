<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TV en Vivo - Maik Sport</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="preconnect" href="https://images.unsplash.com">
    <!-- Web App Manifest -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#1e3a8a">
    

<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Roboto', -apple-system, BlinkMacSystemFont, sans-serif;
}

:root[data-theme="light"] {
    --bg-primary: #f5f5f5;
    --bg-secondary: #ffffff;
    --text-primary: #333333;
    --text-secondary: #666666;
    --header-bg: linear-gradient(90deg, #1e3a8a, #60a5fa);
    --shadow: 0 3px 12px rgba(0, 0, 0, 0.1);
    --card-bg: linear-gradient(135deg, #e6e6e6, #ffffff);
    --border-color: #e0e0e0;
}

:root[data-theme="dark"] {
    --bg-primary: #0d1b2a;
    --bg-secondary: #1b263b;
    --text-primary: #e0e0e0;
    --text-secondary: #8b949e;
    --header-bg: linear-gradient(90deg, #1e3a8a, #60a5fa);
    --shadow: 0 3px 12px rgba(0, 0, 0, 0.5);
    --card-bg: linear-gradient(135deg, #1e293b, #334155);
    --border-color: #334155;
}

body {
    background: var(--bg-primary);
    color: var(--text-primary);
    overflow-x: hidden;
    padding-bottom: 100px;
    transition: background 0.3s, color 0.3s;
}

/* ========== HEADER CORREGIDO ========== */
header {
    background: var(--header-bg);
    padding: 5px 0;
    position: sticky;
    top: 0;
    z-index: 1000;
    box-shadow: var(--shadow);
}

.header-content {
    max-width: 1200px;
    margin: 0 auto;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 15px;
    padding: 0 20px;
}

.header-title {
    display: flex;
    align-items: center;
    gap: 15px;
    flex-shrink: 0;
}

.header-title h1 {
    color: #ffffff;
    font-size: 28px;
    font-weight: 800;
    letter-spacing: 1.2px;
    text-transform: uppercase;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.4);
    white-space: nowrap;
}

.soccer-ball {
    font-size: 34px;
    color: #ffffff;
    animation: spin 3s linear infinite, bounce 1.2s ease-in-out infinite, glow 2s ease-in-out infinite;
    filter: drop-shadow(0 3px 8px rgba(0, 0, 0, 0.6));
    transform-origin: center;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

@keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-8px); }
}

@keyframes glow {
    0%, 100% { filter: drop-shadow(0 3px 8px rgba(0, 0, 0, 0.6)); }
    50% { filter: drop-shadow(0 3px 12px rgba(96, 165, 250, 0.9)); }
}

/* Botones del header */
.header-search {
    display: flex;
    align-items: center;
    gap: 15px;
    flex-wrap: nowrap;
}

.search-toggle,
.favorites-toggle,
.theme-toggle,
.back-button {
    background: #2a2a2a;
    border: none;
    border-radius: 50%;
    width: 45px;
    height: 45px;
    color: #ffffff;
    font-size: 18px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 3px 8px rgba(0, 0, 0, 0.4);
    transition: all 0.3s;
    flex-shrink: 0;
}

.search-toggle:hover,
.theme-toggle:hover,
.back-button:hover {
    background: #60a5fa;
    transform: scale(1.1);
}

.back-button {
    text-decoration: none;
}

/* Botón de favoritos específico */
.favorites-toggle {
    color: #ff1500;
}

.favorites-toggle:hover {
    background: #ff1500;
    color: white;
    transform: scale(1.1);
}

.favorites-toggle.active {
    background: #ff1500;
    color: white;
    box-shadow: 0 0 10px rgba(255, 21, 0, 0.5);
    animation: pulse-heart 1.5s infinite;
}

@keyframes pulse-heart {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
}

/* Formulario de búsqueda */
.header-search-form {
    display: none;
    position: relative;
    width: 250px;
}

.header-search-form.active {
    display: block;
}

.header-search-input {
    width: 100%;
    padding: 10px 15px;
    padding-right: 40px;
    border: none;
    border-radius: 25px;
    background: rgba(255, 255, 255, 0.15);
    color: #ffffff;
    font-size: 14px;
    backdrop-filter: blur(10px);
    transition: all 0.3s;
}

.header-search-input:focus {
    outline: none;
    background: rgba(255, 255, 255, 0.25);
    box-shadow: 0 0 0 2px #60a5fa;
}

.header-search-input::placeholder {
    color: rgba(255, 255, 255, 0.7);
}

.header-search-close {
    position: absolute;
    right: 10px;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    color: #ffffff;
    cursor: pointer;
    font-size: 16px;
}

.search-suggestions {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: rgba(30, 41, 59, 0.98);
    border-radius: 0 0 10px 10px;
    max-height: 200px;
    overflow-y: auto;
    display: none;
    z-index: 1002;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
}

.search-suggestions.active {
    display: block;
}

.suggestion-item {
    padding: 10px 15px;
    cursor: pointer;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    color: #e0e0e0;
}

.suggestion-item:hover {
    background: rgba(96, 165, 250, 0.2);
}

/* ========== RESPONSIVE HEADER ========== */
@media (max-width: 768px) {
    .header-content {
        padding: 0 15px;
        gap: 10px;
    }
    
    .header-title h1 {
        font-size: 18px;
    }
    
    .soccer-ball {
        font-size: 24px;
    }
    
    .header-search {
        gap: 8px;
    }
    
    .search-toggle,
    .favorites-toggle,
    .theme-toggle,
    .back-button {
        width: 40px;
        height: 40px;
        font-size: 16px;
    }
    
    .header-search-form {
        position: absolute;
        top: 100%;
        right: 0;
        width: 100%;
        z-index: 1001;
        background: rgba(30, 41, 59, 0.95);
        padding: 10px;
        border-radius: 0 0 10px 10px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
    }
    
    .header-search-input {
        font-size: 16px;
    }
}

@media (min-width: 769px) and (max-width: 1024px) {
    .header-title h1 {
        font-size: 22px;
    }
    
    .header-search-form {
        width: 200px;
    }
}

@media (min-width: 1200px) {
    .header-content {
        padding: 0;
    }
}

/* ========== ESTILOS EXISTENTES (TODO EL RESTO) ========== */
/* Bottom Navigation */
.bottom-nav {
    position: fixed;
    bottom: 15px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(30, 41, 59, 0.95);
    backdrop-filter: blur(12px);
    border-radius: 12px;
    padding: 10px 15px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
    z-index: 1000;
    display: flex;
    gap: 10px;
    border: 1px solid rgba(96, 165, 250, 0.3);
    width: auto;
    max-width: calc(100% - 20px);
    justify-content: center;
}

.bottom-nav a {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 4px;
    padding: 10px 15px;
    color: #ffffff;
    text-decoration: none;
    font-size: 14px;
    font-weight: 500;
    border-radius: 8px;
    transition: all 0.3s;
    white-space: nowrap;
    flex: 1;
}

.bottom-nav a i {
    font-size: 18px;
}

.bottom-nav a:hover {
    background: rgba(96, 165, 250, 0.3);
    transform: scale(1.05);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
}

.bottom-nav a.active {
    background: rgba(96, 165, 250, 0.3);
    transform: scale(1.05);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
}

@media (max-width: 768px) {
    .bottom-nav {
        padding: 8px 10px;
        gap: 8px;
        border-radius: 10px;
        max-width: calc(100% - 15px);
    }

    .bottom-nav a {
        padding: 8px 12px;
        font-size: 12px;
        gap: 3px;
    }

    .bottom-nav a i {
        font-size: 16px;
    }
}

/* Contenido principal */
.container {
    max-width: 1200px;
    margin: 25px auto;
    padding: 0 20px;
    text-align: center;
}

/* Reproductor de video */
.player-container {
    display: flex;
    flex-direction: column;
    gap: 20px;
    margin-bottom: 30px;
    position: relative;
}

@media (min-width: 768px) {
    .player-container {
        flex-direction: row;
    }
}

#video-player {
    flex: 2;
    background-color: black;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
    position: relative;
    min-height: 280px;
}

/* OPTIMIZACIÓN: Deshabilitar controles del reproductor */
#video {
    width: 100%;
    height: 100%;
    min-height: 280px;
    /* Remover controles nativos */
    outline: none;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
}

/* Ocultar todos los controles nativos del video */
#video::-webkit-media-controls {
    display: none !important;
}

#video::-webkit-media-controls-panel {
    display: none !important;
}

#video::-webkit-media-controls-play-button {
    display: none !important;
}

#video::-webkit-media-controls-timeline-container {
    display: none !important;
}

#video::-webkit-media-controls-timeline {
    display: none !important;
}

#video::-webkit-media-controls-current-time-display {
    display: none !important;
}

#video::-webkit-media-controls-time-remaining-display {
    display: none !important;
}

#video::-webkit-media-controls-mute-button {
    display: none !important;
}

#video::-webkit-media-controls-volume-slider {
    display: none !important;
}

#video::-webkit-media-controls-fullscreen-button {
    display: none !important;
}

#video::-webkit-media-controls-start-playback-button {
    display: none !important;
}

/* Para Firefox */
#video::-moz-media-controls {
    display: none !important;
}

/* Deshabilitar menú contextual */
#video {
    pointer-events: none;
}

/* Permitir solo el clic para pantalla completa */
#video-player {
    pointer-events: auto;
}

.player-placeholder {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, #1a202c, #2d3748);
    color: #e0e0e0;
    padding: 20px;
    text-align: center;
}

.player-placeholder i {
    font-size: 2.5rem;
    margin-bottom: 15px;
    color: #60a5fa;
}

.channel-info {
    flex: 1;
    background: var(--card-bg);
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
    color: var(--text-primary);
    position: relative;
}

.channel-info h3 {
    color: #60a5fa;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 1px solid var(--border-color);
    font-size: 1.2rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
}

/* Indicador EN VIVO en la sección de información */
.live-indicator-small {
    background: #22c55e;
    color: white;
    border-radius: 4px;
    padding: 4px 8px;
    font-size: 0.8rem;
    font-weight: bold;
    display: inline-flex;
    align-items: center;
    gap: 4px;
    animation: pulse-live 2s infinite;
}

@keyframes pulse-live {
    0% { opacity: 0.8; }
    50% { opacity: 1; }
    100% { opacity: 0.8; }
}

.channel-details {
    margin-top: 15px;
    min-height: 100px;
    transition: all 0.3s;
}

.channel-details p {
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    font-size: 0.95rem;
}

.channel-details i {
    margin-right: 8px;
    color: #60a5fa;
    width: 16px;
}

/* Mensaje de error */
.error-message {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(239, 68, 68, 0.9);
    color: white;
    padding: 20px;
    border-radius: 10px;
    text-align: center;
    display: none;
    z-index: 10;
}

/* Indicador de carga */
.loading {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    display: flex;
    flex-direction: column;
    align-items: center;
    color: white;
    z-index: 10;
}

.loading-spinner {
    width: 40px;
    height: 40px;
    border: 4px solid rgba(255, 255, 255, 0.3);
    border-top: 4px solid #60a5fa;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin-bottom: 10px;
}

/* Controles de la aplicación */
.controls {
    display: flex;
    justify-content: center;
    gap: 15px;
    margin-bottom: 30px;
    flex-wrap: wrap;
}

.control-button {
    background: linear-gradient(135deg, #1e3a8a, #60a5fa);
    color: white;
    border: none;
    padding: 12px 20px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 500;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    gap: 8px;
    box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3);
}

.control-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
}

.control-button.active {
    background: linear-gradient(135deg, #22c55e, #16a34a);
}

/* Secciones de canales */
.section-buttons {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
    overflow-x: auto;
    padding: 10px 0;
    justify-content: center;
    flex-wrap: wrap;
}

.section-button {
    background: var(--card-bg);
    color: var(--text-primary);
    border: none;
    padding: 10px 15px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 500;
    transition: all 0.3s;
    white-space: nowrap;
    display: flex;
    align-items: center;
    gap: 8px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
}

.section-button:hover {
    background: linear-gradient(135deg, #1e3a8a, #60a5fa);
    color: white;
    transform: translateY(-2px);
}

.section-button.active {
    background: linear-gradient(135deg, #1e3a8a, #60a5fa);
    color: white;
}

/* Grid de canales */
.channel-list {
    margin-bottom: 30px;
}

.channel-list h2 {
    color: #60a5fa;
    margin-bottom: 20px;
    padding-bottom: 10px;
    border-bottom: 2px solid var(--border-color);
    display: flex;
    align-items: center;
    gap: 10px;
}

.channel-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 20px;
    padding: 20px 0;
}

.channel-item {
    background: var(--card-bg);
    border-radius: 10px;
    padding: 15px;
    cursor: pointer;
    transition: all 0.3s;
    box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3);
    position: relative;
    overflow: hidden;
}

.channel-item:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
}

.channel-item.active {
    border: 2px solid #60a5fa;
    box-shadow: 0 0 15px rgba(96, 165, 250, 0.5);
}

.image-container {
    position: relative;
    margin-bottom: 10px;
}

.channel-item img {
    width: 100%;
    height: 120px;
    object-fit: contain;
    border-radius: 8px;
    background: rgba(255, 255, 255, 0.1);
}

.favorite-icon {
    position: absolute;
    top: 8px;
    right: 8px;
    background: rgba(0, 0, 0, 0.7);
    color: #ccc;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s;
    z-index: 2;
}

.favorite-icon:hover {
    background: rgba(255, 21, 0, 0.8);
    color: white;
    transform: scale(1.1);
}

.favorite-icon.active {
    background: #ff1500;
    color: white;
    animation: pulse-heart 1.5s infinite;
}

.channel-name {
    font-weight: 600;
    margin-bottom: 5px;
    color: var(--text-primary);
    font-size: 14px;
}

.channel-description {
    font-size: 12px;
    color: var(--text-secondary);
    display: flex;
    align-items: center;
    gap: 5px;
}

/* Modales */
.modal {
    display: none;
    position: fixed;
    z-index: 2000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(5px);
}

.modal-content {
    background: var(--card-bg);
    margin: 10% auto;
    padding: 30px;
    border-radius: 15px;
    width: 90%;
    max-width: 500px;
    position: relative;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    color: var(--text-primary);
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 1px solid var(--border-color);
}

.modal-header h3 {
    color: #60a5fa;
    margin: 0;
}

.close {
    color: var(--text-secondary);
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
    transition: color 0.3s;
}

.close:hover {
    color: #60a5fa;
}

/* Responsive */
@media (max-width: 768px) {
    .container {
        padding: 0 15px;
    }
    
    .channel-grid {
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 15px;
    }
    
    .controls {
        gap: 10px;
    }
    
    .control-button {
        padding: 10px 15px;
        font-size: 12px;
    }
    
    .section-buttons {
        justify-content: flex-start;
    }
}

@media (max-width: 480px) {
    .channel-grid {
        grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
        gap: 10px;
    }
    
    .channel-item {
        padding: 10px;
    }
    
    .channel-item img {
        height: 80px;
    }
}
</style>
</head>
<body data-theme="dark">
    <header>
        <div class="header-content">
            <div class="header-title">
                <i class="fas fa-futbol soccer-ball"></i>
                <h1>MAIK SPORT</h1>
            </div>
            <div class="header-search">
                <button class="search-toggle" onclick="toggleSearch()">
                    <i class="fas fa-search"></i>
                </button>
                <button class="favorites-toggle" id="favorites-toggle" onclick="toggleFavorites()">
                    <i class="fas fa-heart"></i>
                </button>
                <button class="theme-toggle" onclick="toggleTheme()">
                    <i class="fas fa-moon"></i>
                </button>
                <a href="index.html" class="back-button">
                    <i class="fas fa-home"></i>
                </a>
                
                <form class="header-search-form" id="header-search-form">
                    <input type="text" class="header-search-input" id="header-search-input" placeholder="Buscar canales...">
                    <button type="button" class="header-search-close" onclick="toggleSearch()">
                        <i class="fas fa-times"></i>
                    </button>
                    <div class="search-suggestions" id="search-suggestions"></div>
                </form>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="player-container" id="player-container">
            <div id="video-player">
                <div class="player-placeholder">
                    <i class="fas fa-play-circle"></i>
                    <h3>Selecciona un canal para comenzar</h3>
                    <p>El contenido aparecerá aquí</p>
                </div>
                <video id="video" style="display: none;"></video>
                
                <div class="error-message" id="error-message">
                    Error al cargar el canal. Intenta nuevamente.
                </div>
                <div class="loading" id="loading" style="display: none;">
                    <div class="loading-spinner"></div>
                    <p>Cargando canal...</p>
                </div>
            </div>
            
            <div class="channel-info">
                <h3>Información del Canal <span class="live-indicator-small" id="live-indicator-small" style="display: none;">EN VIVO</span></h3>
                <div class="channel-details">
                    <p><i class="fas fa-info-circle"></i> Selecciona un canal para ver su información</p>
                    <p><i class="fas fa-film"></i> Calidad: -</p>
                    <p><i class="fas fa-clock"></i> Estado: -</p>
                </div>
            </div>
        </div>

        <div class="controls">
            <button class="control-button" id="show-channels-btn" onclick="toggleChannels()">
                <i class="fas fa-list"></i> Mostrar Canales
            </button>
            <button class="control-button" onclick="shareChannel()">
                <i class="fas fa-share"></i> Compartir Canal
            </button>
            <button class="control-button" onclick="showPlaylistModal()">
                <i class="fas fa-bookmark"></i> Listas de Reproducción
            </button>
        </div>

        <div class="controls">
            <button class="control-button" id="grid-view-btn" onclick="setViewMode('grid')">
                <i class="fas fa-th"></i> Cuadrícula
            </button>
            <button class="control-button" id="list-view-btn" onclick="setViewMode('list')">
                <i class="fas fa-list"></i> Lista
            </button>
        </div>

        <div class="section-buttons" id="section-buttons"></div>

        <div id="channels-container" style="display: none;"></div>
    </div>

    <nav class="bottom-nav">
        <a href="index.html">
            <i class="fas fa-home"></i>
            <span>Home</span>
        </a>
        <a href="agenda.html">
            <i class="fas fa-calendar"></i>
            <span>Agenda</span>
        </a>
        <a href="tv.html">
            <i class="fas fa-tv"></i>
            <span>TV</span>
        </a>
        <a href="vivo.html" class="active">
            <i class="fas fa-broadcast-tower"></i>
            <span>TV En Vivo</span>
        </a>
    </nav>

    <!-- Modal para continuar reproducción -->
    <div id="continue-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Continuar reproducción</h3>
                <span class="close" onclick="closeContinueModal()">&times;</span>
            </div>
            <p>¿Deseas continuar viendo desde donde lo dejaste?</p>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="control-button" onclick="continuePlaying()">Sí, continuar</button>
                <button class="control-button" onclick="startFromBeginning()">No, empezar de nuevo</button>
            </div>
        </div>
    </div>

    <!-- Modal para compartir canal -->
    <div id="share-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Compartir Canal</h3>
                <span class="close" onclick="closeShareModal()">&times;</span>
            </div>
            <p>Comparte este canal con otros</p>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <input type="text" id="share-url" readonly style="flex: 1; padding: 10px; border-radius: 5px; border: 1px solid var(--border-color); background: var(--bg-secondary); color: var(--text-primary);">
                <button class="control-button" onclick="copyShareUrl()">
                    <i class="fas fa-copy"></i> Copiar Enlace
                </button>
            </div>
            <button class="control-button" onclick="closeShareModal()" style="margin-top: 15px;">Cerrar</button>
        </div>
    </div>

    <!-- Modal para listas de reproducción -->
    <div id="playlist-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Mis Listas de Reproducción</h3>
                <span class="close" onclick="closePlaylistModal()">&times;</span>
            </div>
            <div id="playlist-content">
                <button class="control-button" onclick="createPlaylist()">
                    <i class="fas fa-plus"></i> Crear
                </button>
            </div>
            <button class="control-button" onclick="closePlaylistModal()" style="margin-top: 15px;">Cerrar</button>
        </div>
    </div>

<script>
// Variables globales
let currentHls = null;
let currentChannel = null;
let retryCount = 0;
let maxRetries = 3;
let playbackPositionInterval = null;
let favorites = JSON.parse(localStorage.getItem('favorites') || '{}');
let showingFavorites = false;
let viewMode = localStorage.getItem('viewMode') || 'grid';
let streamCache = JSON.parse(localStorage.getItem('streamCache') || '{}');

// OPTIMIZACIÓN: Prevenir controles del reproductor
function setupVideoControlPrevention() {
    const video = document.getElementById('video');
    if (!video) return;

    // Deshabilitar menú contextual
    video.addEventListener('contextmenu', (e) => {
        e.preventDefault();
        return false;
    });

    // Prevenir pausa del video
    video.addEventListener('pause', (e) => {
        if (currentChannel && video.paused) {
            setTimeout(() => {
                video.play().catch(err => console.warn('Auto-play failed:', err));
            }, 100);
        }
    });

    // Prevenir seeking (adelantar/retroceder)
    video.addEventListener('seeking', (e) => {
        e.preventDefault();
        return false;
    });

    video.addEventListener('seeked', (e) => {
        e.preventDefault();
        return false;
    });

    // Deshabilitar teclas de control
    video.addEventListener('keydown', (e) => {
        // Prevenir teclas de espacio, flechas, etc.
        const preventedKeys = [32, 37, 38, 39, 40, 75, 77]; // space, arrows, k, m
        if (preventedKeys.includes(e.keyCode)) {
            e.preventDefault();
            return false;
        }
    });

    // Remover atributo controls si existe
    video.removeAttribute('controls');
    
    // Asegurar que no se puedan agregar controles dinámicamente
    const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
            if (mutation.type === 'attributes' && mutation.attributeName === 'controls') {
                video.removeAttribute('controls');
            }
        });
    });
    
    observer.observe(video, { attributes: true });
}

// Configuración inicial
document.addEventListener('DOMContentLoaded', function() {
    setupVideoControlPrevention();
    cargarCanales();
    setupDoubleClickFullscreen();
    setupTouchGestures();
    setViewMode(viewMode);
    
    // Configurar tema
    const savedTheme = localStorage.getItem('theme') || 'dark';
    document.documentElement.setAttribute('data-theme', savedTheme);
    updateThemeIcon();
    
    // Verificar si hay una posición guardada
    checkSavedPosition();
});


 // Variables globales
    let currentHls = null;
    let currentChannel = null;
    let todosCanales = {};
    let canalesCargados = false;
    let channelsVisible = true;
    let favorites = JSON.parse(localStorage.getItem('favoriteChannels')) || {};
    let showingFavorites = false;
    let playbackPositionInterval = null;
    let retryCount = 0;
    const MAX_RETRIES = 3;
    let streamCache = JSON.parse(localStorage.getItem('streamCache')) || {};
    let currentView = localStorage.getItem('viewPreference') || 'grid';
    let deferredPrompt = null;

    // Nuevo: Servidores proxy para evitar CORS y contenido mixto
    const PROXY_SERVERS = [
        'https://corsproxy.io/?',
        'https://api.codetabs.com/v1/proxy?quest=',
        'https://cors-anywhere.herokuapp.com/',
        'https://proxy.cors.sh/'
    ];
    let currentProxyIndex = 0;

    // Función para obtener URL a través de proxy
    function getProxiedUrl(url) {
        // Si ya es una URL local o relativa, no usar proxy
        if (url.startsWith('/') || url.startsWith(window.location.origin) || url.startsWith('data:')) {
            return url;
        }
        
        // Para el archivo JSON de canales, usar proxy
        if (url.includes('canales_organizados.json')) {
            return PROXY_SERVERS[currentProxyIndex] + encodeURIComponent(url);
        }
        
        // Para streams HTTP, usar proxy para convertirlos a HTTPS
        if (url.startsWith('http://')) {
            return PROXY_SERVERS[currentProxyIndex] + encodeURIComponent(url);
        }
        
        // Para otros casos, devolver la URL original
        return url;
    }

    // Función para rotar proxy si falla
    function rotateProxy() {
        currentProxyIndex = (currentProxyIndex + 1) % PROXY_SERVERS.length;
        console.log(`Cambiando a proxy: ${PROXY_SERVERS[currentProxyIndex]}`);
    }

    // Función para cargar canales desde JSON
    async function cargarCanales() {
        if (canalesCargados) return;
        
        try {
            mostrarLoading(true);
            
            // Intentar cargar desde múltiples ubicaciones
            const posiblesUbicaciones = [
                'canales_organizados.json',
                '/canales_organizados.json',
                './canales_organizados.json',
                'https://raw.githubusercontent.com/tu_usuario/tu_repo/main/canales_organizados.json'
            ];
            
            let response = null;
            let lastError = null;
            
            for (let i = 0; i < posiblesUbicaciones.length; i++) {
                try {
                    const url = getProxiedUrl(posiblesUbicaciones[i]);
                    console.log(`Intentando cargar canales desde: ${url}`);
                    
                    response = await fetch(url);
                    if (response.ok) {
                        todosCanales = await response.json();
                        console.log('Canales cargados exitosamente desde:', posiblesUbicaciones[i]);
                        break;
                    }
                } catch (error) {
                    lastError = error;
                    console.error(`Error cargando desde ${posiblesUbicaciones[i]}:`, error);
                    
                    // Rotar proxy para el próximo intento
                    if (i < posiblesUbicaciones.length - 1) {
                        rotateProxy();
                    }
                }
            }
            
            if (!response || !response.ok) {
                throw lastError || new Error('No se pudo cargar el archivo de canales desde ninguna ubicación');
            }
            
            canalesCargados = true;
            
            crearBotonesCategorias();
            
            if (Object.keys(todosCanales).length > 0) {
                const primeraCategoria = Object.keys(todosCanales)[0];
                mostrarCategoria(primeraCategoria);
            }
            
            inicializarBusqueda();
            mostrarLoading(false);
            
            loadPlaybackPosition();
        } catch (error) {
            console.error('Error cargando canales:', error);
            
            // Intentar cargar una versión de respaldo desde localStorage
            try {
                const backup = localStorage.getItem('canalesBackup');
                if (backup) {
                    todosCanales = JSON.parse(backup);
                    canalesCargados = true;
                    crearBotonesCategorias();
                    
                    if (Object.keys(todosCanales).length > 0) {
                        const primeraCategoria = Object.keys(todosCanales)[0];
                        mostrarCategoria(primeraCategoria);
                    }
                    
                    mostrarLoading(false);
                    showToast('Usando datos de respaldo. Algunos canales pueden estar desactualizados.');
                    return;
                }
            } catch (backupError) {
                console.error('Error cargando respaldo:', backupError);
            }
            
            mostrarError('Error al cargar la lista de canales. Verifica tu conexión e intenta recargar la página.');
            mostrarLoading(false);
        }
    }

    // Función para deshabilitar controles de progreso y pausa
    function disableSeekAndPauseControls() {
        const video = document.getElementById('video');
        if (!video) return;

        // Prevenir interacción con la barra de progreso pero permitir controles de volumen
        const existingStyle = document.getElementById('hide-controls-style');
        if (!existingStyle) {
            const style = document.createElement('style');
            style.id = 'hide-controls-style';
            style.innerHTML = `
                /* Ocultar solo barra de progreso pero permitir controles de volumen */
                #video::-webkit-media-controls-timeline,
                #video::-webkit-media-controls-current-time-display,
                #video::-webkit-media-controls-time-remaining-display,
                #video::-webkit-media-controls-timeline-container {
                    display: none !important;
                }
                
                /* Ocultar en pantalla completa también */
                video:fullscreen::-webkit-media-controls-timeline,
                video:fullscreen::-webkit-media-controls-current-time-display,
                video:fullscreen::-webkit-media-controls-time-remaining-display {
                    display: none !important;
                }
                
                /* Asegurar que los controles nativos sean visibles en móviles */
                #video::-webkit-media-controls {
                    display: flex !important;
                }
                
                #video::-webkit-media-controls-volume-slider,
                #video::-webkit-media-controls-mute-button {
                    display: flex !important;
                }
                
                /* Para iOS específicamente */
                #video::-webkit-media-controls-start-playback-button {
                    display: none !important;
                    opacity: 0 !important;
                    pointer-events: none !important;
                    width: 0 !important;
                    height: 0 !important;
                }
            `;
            document.head.appendChild(style);
        }
    }

    // Función para forzar la reproducción si se intenta pausar
    function preventVideoPause() {
        const video = document.getElementById('video');
        if (!video) return;

        video.addEventListener('pause', () => {
            // Si hay un canal cargado y el video se ha pausado, forzar su reproducción.
            if (currentChannel && video.paused) {
                // Usamos un pequeño timeout para evitar bucles infinitos en algunos navegadores.
                setTimeout(() => {
                    video.play().catch(e => console.warn("Reanudación forzada falló:", e));
                }, 150);
            }
        });
    }

    // Función para habilitar pantalla completa con doble clic/tap
    function setupDoubleClickFullscreen() {
        const videoPlayer = document.getElementById('video-player');
        if (!videoPlayer) return;

        videoPlayer.addEventListener('dblclick', () => {
            if (!document.fullscreenElement) {
                videoPlayer.requestFullscreen().catch(err => {
                    console.error(`Error al activar pantalla completa: ${err.message}`);
                });
            } else {
                document.exitFullscreen();
            }
        });
    }

    // Gestos táctiles
    function setupTouchGestures() {
        const videoPlayer = document.getElementById('video-player');
        let startX = 0;
        let startY = 0;
        let startTime = 0;
        const minSwipeDist = 50;
        const maxSwipeTime = 500;
        let isDoubleTap = false;
        
        // Para detectar doble tap
        let lastTap = 0;
        let tapTimeout;
        
        videoPlayer.addEventListener('touchstart', function(e) {
            if (e.touches.length === 1) {
                const touch = e.touches[0];
                startX = touch.clientX;
                startY = touch.clientY;
                startTime = new Date().getTime();
                
                // Detectar doble tap
                const currentTime = new Date().getTime();
                const tapLength = currentTime - lastTap;
                
                if (tapLength < 300 && tapLength > 0) {
                    // Es un doble tap - toggle fullscreen
                    clearTimeout(tapTimeout);
                    isDoubleTap = true;
                    
                    if (!document.fullscreenElement) {
                        videoPlayer.requestFullscreen().catch(err => {
                            console.error(`Error al activar pantalla completa: ${err.message}`);
                        });
                    } else {
                        document.exitFullscreen();
                    }
                } else {
                    // Es un solo tap
                    isDoubleTap = false;
                    tapTimeout = setTimeout(() => {
                        lastTap = 0;
                    }, 300);
                }
                lastTap = currentTime;
            }
        }, { passive: true });
        
        videoPlayer.addEventListener('touchend', function(e) {
            if (isDoubleTap || e.touches.length > 0) return;
            
            const touch = e.changedTouches[0];
            const distX = touch.clientX - startX;
            const distY = touch.clientY - startY;
            const elapsedTime = new Date().getTime() - startTime;
            
            if (elapsedTime <= maxSwipeTime && !isDoubleTap) {
                if (Math.abs(distX) >= minSwipeDist && Math.abs(distY) <= 100) {
                    // Deslizamiento horizontal - Cambiar canal
                    if (distX > 0) {
                        navigateToPreviousChannel();
                    } else {
                        navigateToNextChannel();
                    }
                }
            }
        }, { passive: true });
        
        // Prevenir zoom con doble tap
        videoPlayer.addEventListener('gesturestart', function(e) {
            e.preventDefault();
        });
        
        videoPlayer.addEventListener('gesturechange', function(e) {
            e.preventDefault();
        });
        
        videoPlayer.addEventListener('gestureend', function(e) {
            e.preventDefault();
        });
    }

    // Navegar al canal anterior
    function navigateToPreviousChannel() {
        if (!currentChannel) return;
        
        const currentCategory = currentChannel.description;
        const currentChannels = todosCanales[currentCategory];
        
        if (!currentChannels) return;
        
        const currentIndex = currentChannels.findIndex(c => c.nombre === currentChannel.name);
        if (currentIndex > 0) {
            const previousChannel = currentChannels[currentIndex - 1];
            cambiarCanal(previousChannel.url, previousChannel.nombre, currentCategory, previousChannel.logo);
        }
    }

    // Navegar al siguiente canal
    function navigateToNextChannel() {
        if (!currentChannel) return;
        
        const currentCategory = currentChannel.description;
        const currentChannels = todosCanales[currentCategory];
        
        if (!currentChannels) return;
        
        const currentIndex = currentChannels.findIndex(c => c.nombre === currentChannel.name);
        if (currentIndex < currentChannels.length - 1) {
            const nextChannel = currentChannels[currentIndex + 1];
            cambiarCanal(nextChannel.url, nextChannel.nombre, currentCategory, nextChannel.logo);
        }
    }

    // Función para crear botones de categorías
    function crearBotonesCategorias() {
        const contenedor = document.getElementById('section-buttons');
        if (!contenedor) return;
        
        contenedor.innerHTML = '';
        
        Object.keys(todosCanales).forEach(categoria => {
            if (todosCanales[categoria].length > 0) {
                const boton = document.createElement('div');
                boton.className = 'section-button';
                boton.innerHTML = `<i class="fas fa-folder"></i> ${categoria}`;
                boton.onclick = () => {
                    showingFavorites = false;
                    document.querySelectorAll('.section-button').forEach(b => b.classList.remove('active'));
                    boton.classList.add('active');
                    mostrarCategoria(categoria);
                    
                    // Quitar resaltado del botón de favoritos
                    document.getElementById('favorites-toggle').classList.remove('active');
                    
                    setTimeout(() => {
                        smoothScrollTo('channels-container');
                    }, 100);
                };
                contenedor.appendChild(boton);
            }
        });
        
        if (contenedor.firstChild) {
            contenedor.firstChild.classList.add('active');
        }
        
        setTimeout(adjustCategoryScroll, 100);
    }

    // Función para mostrar canales de una categoría
    function mostrarCategoria(categoria) {
        showingFavorites = false;

        // Quitar resaltado del botón de favoritos
        document.getElementById('favorites-toggle').classList.remove('active');
        
        const canales = todosCanales[categoria];
        if (!canales) return;
        
        document.querySelectorAll('.channel-list').forEach(el => {
            el.style.display = 'none';
        });
        
        const seccionId = `categoria-${categoria.replace(/\W+/g, '-').toLowerCase()}`;
        let seccion = document.getElementById(seccionId);
        
        if (!seccion) {
            seccion = document.createElement('div');
            seccion.id = seccionId;
            seccion.className = 'channel-list';
            document.getElementById('channels-container').appendChild(seccion);
        }
        
        seccion.innerHTML = `
            <h2><i class="fas fa-folder"></i> ${categoria}</h2>
            <div class="channel-grid"></div>
        `;
        
        const grid = seccion.querySelector('.channel-grid');
        canales.forEach(canal => {
            const item = document.createElement('div');
            item.className = 'channel-item';
            
            const logoSrc = canal.logo || canal['tvg-logo'] || '';
            const channelId = `${categoria}-${canal.nombre}`;
            const isFavorite = favorites[channelId] !== undefined;
            
            item.innerHTML = `
                <div class="image-container">
                    <img src="${logoSrc}" 
                         alt="${canal.nombre}" 
                         onerror="handleImageError(this)">
                    <div class="favorite-icon ${isFavorite ? 'active' : ''}" onclick="toggleFavorite('${canal.nombre}', '${categoria}', event)">
                        <i class="fas fa-heart"></i>
                    </div>
                </div>
                <div class="channel-name">${canal.nombre}</div>
                <div class="channel-description">${categoria}</div>
            `;
            
            const streamUrl = canal.url || canal.link || '';
            item.onclick = () => {
                cambiarCanal(streamUrl, canal.nombre, categoria, logoSrc);
                toggleChannels();
                
                setTimeout(() => {
                    smoothScrollTo('player-container');
                }, 300);
            };
            grid.appendChild(item);
        }
        
        seccion.style.display = 'block';
    }

    // Función para cambiar de canal
    function cambiarCanal(url, nombre, categoria, logo) {
        console.log('Reproduciendo:', nombre, 'URL:', url);
        
        // Verificar conexión antes de intentar cargar un canal
        if (!navigator.onLine) {
            mostrarError('No hay conexión a internet. No se puede cargar el canal.');
            return;
        }
        
        document.getElementById('loading').style.display = 'flex';
        document.getElementById('error-message').style.display = 'none';
        
        document.querySelector('.player-placeholder').style.display = 'none';
        document.getElementById('video').style.display = 'block';
        
        document.querySelector('.channel-details').innerHTML = `
            <p><i class="fas fa-info-circle"></i> ${nombre}</p>
            <p><i class="fas fa-film"></i> Calidad: HD</p>
            <p><i class="fas fa-clock"></i> Estado: Conectando...</p>
            <p><i class="fas fa-align-left"></i> ${categoria}</p>
        `;
        
        document.getElementById('live-indicator-small').style.display = 'inline-flex';
        
        document.querySelectorAll('.channel-item').forEach(item => {
            item.classList.remove('active');
        });
        
        const items = document.querySelectorAll('.channel-item');
        for (let item of items) {
            if (item.querySelector('.channel-name').textContent === nombre) {
                item.classList.add('active');
                break;
            }
        }
        
        var video = document.getElementById('video');
        
        if (currentHls) {
            currentHls.destroy();
        }
        
        if (playbackPositionInterval) {
            clearInterval(playbackPositionInterval);
        }
        
        video.pause();
        video.src = '';
        
        // Nuevo: Usar proxy para streams HTTP
        const proxiedUrl = getProxiedUrl(url);
        console.log(`Reproduciendo: ${nombre} desde URL: ${proxiedUrl}`);
        
        if (Hls.isSupported()) {
            currentHls = new Hls({
                debug: false,
                enableWorker: true,
                lowLatencyMode: true,
                
                // Buffering configuration OPTIMIZADA
                backBufferLength: 30,
                maxBufferLength: 30,
                maxMaxBufferLength: 60,
                maxBufferSize: 60 * 1000 * 1000, // 60MB
                maxBufferHole: 0.1,
                
                // Asegurar que todos los fragmentos usen proxy
                xhrSetup: function(xhr, url) {
                    // Forzar todas las solicitudes a través del proxy
                    const proxiedUrl = getProxiedUrl(url);
                    xhr.open('GET', proxiedUrl, true);
                },
                
                // Live streaming configuration
                liveSyncDurationCount: 5,
                liveMaxLatencyDurationCount: 15,
                liveDurationInfinity: true,
                
                // ABR configuration
                abrEwmaDefaultEstimate: 500000,
                abrEwmaSlowLive: 3,
                abrEwmaFastLive: 2,
                abrEwmaDefaultLive: 1,
                
                // Performance
                stretchShortVideoTrack: true,
                maxFragLookUpTolerance: 0.1,
                emeEnabled: true,
                
                // Timeouts and retries
                manifestLoadingTimeOut: 10000,
                manifestLoadingMaxRetry: 3,
                manifestLoadingRetryDelay: 1000,
                levelLoadingTimeOut: 10000,
                levelLoadingMaxRetry: 3,
                levelLoadingRetryDelay: 1000,
                fragLoadingTimeOut: 20000,
                fragLoadingMaxRetry: 6,
                fragLoadingRetryDelay: 1000,
                
                // Additional optimizations
                enableDateRange: false,
                enableCEA708Captions: false,
                requestTimeout: 10000,
                levelLoadTimeout: 10000,
                fragLoadTimeout: 20000
            });
            
            currentHls.loadSource(proxiedUrl);
            currentHls.attachMedia(video);
            
            currentHls.on(Hls.Events.MANIFEST_PARSED, function() {
                addToStreamCache(url, url);
                document.getElementById('loading').style.display = 'none';
                retryCount = 0;
                
                video.play().catch(e => {
                    mostrarError('Error al reproducir: ' + e.message);
                });
                
                playbackPositionInterval = setInterval(savePlaybackPosition, 5000);
            });
            
            currentHls.on(Hls.Events.ERROR, function(event, data) {
                if (data.fatal) {
                    console.error('Error fatal de HLS:', data.details);
                    switch(data.type) {
                        case Hls.ErrorTypes.NETWORK_ERROR:
                            // Si hay un error de red, rotamos el proxy y reintentamos
                            mostrarError(`Error de conexión. Reintentando con otro servidor...`);
                            rotateProxy();
                            setTimeout(() => cambiarCanal(url, nombre, categoria, logo), 1000);
                            break;
                        case Hls.ErrorTypes.MEDIA_ERROR:
                            console.error('Error de media, intentando recuperar...');
                            currentHls.recoverMediaError();
                            break;
                        default:
                            // Si es otro error fatal, lo destruimos y reintentamos
                            currentHls.destroy();
                            setTimeout(() => cambiarCanal(url, nombre, categoria, logo), 1000);
                            break;
                    }
                }
            });
        } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
            // Para Safari y otros navegadores que soportan HLS nativamente
            video.src = proxiedUrl;
            video.addEventListener('loadedmetadata', function() {
                addToStreamCache(url, proxiedUrl);
                document.getElementById('loading').style.display = 'none';
                retryCount = 0;
                
                document.querySelector('.channel-details').innerHTML = `
                    <p><i class="fas fa-info-circle"></i> ${nombre}</p>
                    <p><i class="fas fa-film"></i> Calidad: HD</p>
                    <p><i class="fas fa-clock"></i> Estado: Transmitiendo</p>
                    <p><i class="fas fa-align-left"></i> ${categoria}</p>
                `;
                
                video.play().catch(e => {
                    mostrarError('Error al reproducir: ' + e.message);
                });
                
                playbackPositionInterval = setInterval(savePlaybackPosition, 5000);
            });
            
            video.addEventListener('error', function() {
                mostrarError('Error al cargar el video. Reintentando...');
                rotateProxy();
                setTimeout(() => cambiarCanal(url, nombre, categoria, logo), 2000);
            });
        } else {
            mostrarError("Tu navegador no soporta la reproducción de este formato.");
        }
        
        currentChannel = {
            url: url,
            name: nombre,
            description: categoria
        };
    }

    // Función para manejar errores de carga de imágenes
    function handleImageError(img) {
        img.onerror = null;
        
        // Si ya es una URL de proxy o está vacía, no hacer nada más
        if (!img.src || img.src.includes('corsproxy.io') || img.src.includes('cors-anywhere') || 
            img.src.includes('proxy.cors.sh') || img.src.includes('codetabs.com')) {
            return;
        }
        
        // Intentar con proxy primero
        const proxiedSrc = getProxiedUrl(img.src);
        
        // Crear una nueva imagen para probar
        const testImage = new Image();
        testImage.onload = function() {
            img.src = proxiedSrc;
        };
        testImage.onerror = function() {
            // Si falla, mostrar ícono por defecto directamente
            img.style.display = 'none';
            const container = img.parentElement;
            
            // Verificar si ya existe un ícono por defecto
            if (!container.querySelector('.default-icon')) {
                const defaultIcon = document.createElement('div');
                defaultIcon.className = 'default-icon';
                defaultIcon.innerHTML = '<i class="fas fa-tv"></i>';
                container.appendChild(defaultIcon);
            }
        };
        testImage.src = proxiedSrc;
    }

    // Función para desplazar suavemente a un elemento
    function smoothScrollTo(elementId) {
        const element = document.getElementById(elementId);
        if (element) {
            element.scrollIntoView({ 
                behavior: 'smooth',
                block: 'start'
            });
        }
    }

    // Función para ajustar el scroll de categorías en móvil
    function adjustCategoryScroll() {
        if (window.innerWidth <= 768) {
            const sectionButtons = document.getElementById('section-buttons');
            if (sectionButtons) {
                sectionButtons.scrollLeft = 0;
            }
        }
    }

    // Función para guardar favoritos en localStorage
    function saveFavorites() {
        localStorage.setItem('favoriteChannels', JSON.stringify(favorites));
    }

    // Función para guardar la última posición de reproducción
    function savePlaybackPosition() {
        if (currentChannel && currentChannel.url) {
            const video = document.getElementById('video');
            const position = video.currentTime;
            
            const playbackInfo = {
                channel: currentChannel,
                position: position,
                timestamp: Date.now()
            };
            
            localStorage.setItem('lastPlayback', JSON.stringify(playbackInfo));
        }
    }

    // Función para cargar la última posición de reproducción
    function loadPlaybackPosition() {
        const playbackInfo = JSON.parse(localStorage.getItem('lastPlayback'));
        if (playbackInfo && playbackInfo.channel && playbackInfo.position) {
            document.getElementById('last-channel-name').textContent = playbackInfo.channel.name;
            document.getElementById('continue-modal').classList.add('active');
            
            document.getElementById('continue-yes').onclick = function() {
                cambiarCanal(
                    playbackInfo.channel.url, 
                    playbackInfo.channel.name, 
                    playbackInfo.channel.description
                );
                
                const video = document.getElementById('video');
                const checkVideoReady = setInterval(function() {
                    if (video.readyState > 0) {
                        video.currentTime = playbackInfo.position;
                        clearInterval(checkVideoReady);
                    }
                }, 500);
                
                document.getElementById('continue-modal').classList.remove('active');
            };
            
            document.getElementById('continue-no').onclick = function() {
                localStorage.removeItem('lastPlayback');
                document.getElementById('continue-modal').classList.remove('active');
            };
        }
    }

    // Función para alternar un canal como favorito
    function toggleFavorite(channelName, category, event) {
        if (event) event.stopPropagation();
        
        const channelId = `${category}-${channelName}`;
        
        if (favorites[channelId]) {
            delete favorites[channelId];
        } else {
            favorites[channelId] = {
                name: channelName,
                category: category
            };
        }
        
        saveFavorites();
        
        // Actualizar el estado visual del ícono
        const favoriteIcons = document.querySelectorAll('.favorite-icon');
        favoriteIcons.forEach(icon => {
            const item = icon.closest('.channel-item');
            if (item && item.querySelector('.channel-name').textContent === channelName) {
                if (favorites[channelId]) {
                    icon.classList.add('active');
                } else {
                    icon.classList.remove('active');
                }
            }
        });
        
        if (showingFavorites) {
            mostrarFavoritos();
        }
        
        return favorites[channelId] !== undefined;
    }

    // Función para agregar a caché de streams
    function addToStreamCache(url, data) {
        const keys = Object.keys(streamCache);
        if (keys.length >= 20) {
            delete streamCache[keys[0]];
        }
        
        streamCache[url] = {
            data: data,
            timestamp: Date.now()
        };
        
        localStorage.setItem('streamCache', JSON.stringify(streamCache));
    }

    // Función para obtener del caché de streams
    function getFromStreamCache(url) {
        const cached = streamCache[url];
        if (cached && (Date.now() - cached.timestamp) < 3600000) {
            return cached.data;
        }
        return null;
    }

    // Función para mostrar canales favoritos
    function mostrarFavoritos() {
        showingFavorites = true;
        
        // Resaltar el botón de favoritos
        document.getElementById('favorites-toggle').classList.add('active');
        
        document.querySelectorAll('.channel-list').forEach(el => {
            el.style.display = 'none';
        });
        
        document.querySelectorAll('.section-button').forEach(b => b.classList.remove('active'));
        
        const seccionId = 'favoritos';
        let seccion = document.getElementById(seccionId);
        
        if (!seccion) {
            seccion = document.createElement('div');
            seccion.id = seccionId;
            seccion.className = 'channel-list';
            document.getElementById('channels-container').appendChild(seccion);
        }
        
        const canalesFavoritos = [];
        for (const id in favorites) {
            const favorite = favorites[id];
            for (const categoria in todosCanales) {
                const canal = todosCanales[categoria].find(c => c.nombre === favorite.name);
                if (canal) {
                    canalesFavoritos.push({
                        ...canal,
                        categoria: favorite.category || categoria
                    });
                    break;
                }
            }
        }
        
        if (canalesFavoritos.length === 0) {
            seccion.innerHTML = `
                <h2><i class="fas fa-heart"></i> Favoritos</h2>
                <div class="no-results" style="display: block;">
                    <i class="fas fa-heart" style="color: #ff1500;"></i>
                    <h3>No tienes canales favoritos</h3>
                    <p>Haz clic en el corazón de un canal para agregarlo.</p>
                </div>
            `;
        } else {
            seccion.innerHTML = `
                <h2><i class="fas fa-heart"></i> Favoritos (${canalesFavoritos.length})</h2>
                <div class="channel-grid"></div>
            `;
            
            const grid = seccion.querySelector('.channel-grid');
            canalesFavoritos.forEach(canal => {
                const item = document.createElement('div');
                item.className = 'channel-item';
                
                const logoSrc = canal.logo || canal['tvg-logo'] || '';
                const channelId = `${canal.categoria}-${canal.nombre}`;
                const isFavorite = favorites[channelId] !== undefined;
                
                item.innerHTML = `
                    <div class="image-container">
                        <img src="${logoSrc}" 
                             alt="${canal.nombre}" 
                             onerror="handleImageError(this)">
                        <div class="favorite-icon active" onclick="toggleFavorite('${canal.nombre}', '${canal.categoria}', event)">
                            <i class="fas fa-heart"></i>
                        </div>
                    </div>
                    <div class="channel-name">${canal.nombre}</div>
                    <div class="channel-description">${canal.categoria}</div>
                `;
                
                const streamUrl = canal.url || canal.link || '';
                item.onclick = () => {
                    cambiarCanal(streamUrl, canal.nombre, canal.categoria, logoSrc);
                    toggleChannels();
                    
                    setTimeout(() => {
                        smoothScrollTo('player-container');
                    }, 300);
                };
                grid.appendChild(item);
            });
        }
        
        seccion.style.display = 'block';
    }

    // Función para mostrar/ocultar canales
    function toggleChannels() {
        const channelsContainer = document.getElementById('channels-container');
        const sectionButtons = document.getElementById('section-buttons');
        const viewToggle = document.getElementById('view-toggle');
        const toggleBtn = document.getElementById('toggle-channels-btn');
        
        channelsVisible = !channelsVisible;
        
        if (channelsVisible) {
            channelsContainer.style.display = 'block';
            sectionButtons.style.display = 'flex';
            viewToggle.style.display = 'flex';
            toggleBtn.innerHTML = '<i class="fas fa-eye-slash"></i> Ocultar Canales';
            
            setTimeout(() => {
                smoothScrollTo('channels-container');
            }, 100);
        } else {
            channelsContainer.style.display = 'none';
            sectionButtons.style.display = 'none';
            viewToggle.style.display = 'none';
            toggleBtn.innerHTML = '<i class="fas fa-list"></i> Mostrar Canales';
            
            setTimeout(() => {
                smoothScrollTo('player-container');
            }, 100);
        }
    }

    // Configurar el botón de favoritos en el header
    function setupFavoritesToggle() {
        const favoritesToggle = document.getElementById('favorites-toggle');
        
        favoritesToggle.addEventListener('click', () => {
            // Mostrar favoritos
            mostrarFavoritos();
            
            // Si los canales están ocultos, mostrarlos primero
            if (!channelsVisible) {
                toggleChannels();
            }
            
            // Scroll suave a la sección de canales
            setTimeout(() => {
                smoothScrollTo('channels-container');
            }, 100);
        });
    }

    // Inicializar búsqueda
    function inicializarBusqueda() {
        const searchInput = document.getElementById('header-search-input');
        const searchSuggestions = document.getElementById('search-suggestions');
        
        if (!searchInput) return;
        
        // Sugerencias en tiempo real
        searchInput.addEventListener('input', function(e) {
            const termino = e.target.value.toLowerCase().trim();
            searchSuggestions.innerHTML = '';
            
            if (termino.length < 2) {
                searchSuggestions.classList.remove('active');
                if (showingFavorites) {
                    mostrarFavoritos();
                } else {
                    Object.keys(todosCanales).forEach(categoria => {
                        const seccion = document.getElementById(`categoria-${categoria.replace(/\W+/g, '-').toLowerCase()}`);
                        if (seccion) seccion.style.display = 'block';
                    });
                }
                document.getElementById('no-results').style.display = 'none';
                return;
            }
            
            // Generar sugerencias
            const sugerencias = [];
            Object.keys(todosCanales).forEach(categoria => {
                todosCanales[categoria].forEach(canal => {
                    if (canal.nombre.toLowerCase().includes(termino) || 
                        categoria.toLowerCase().includes(termino)) {
                        sugerencias.push({ canal, categoria });
                    }
                });
            });
            
            // Mostrar sugerencias
            if (sugerencias.length > 0) {
                searchSuggestions.classList.add('active');
                sugerencias.slice(0, 5).forEach(({ canal, categoria }) => {
                    const suggestionItem = document.createElement('div');
                    suggestionItem.className = 'suggestion-item';
                    suggestionItem.innerHTML = `
                        <i class="fas fa-tv"></i> ${canal.nombre} <small>(${categoria})</small>
                    `;
                    suggestionItem.onclick = () => {
                        const streamUrl = canal.url || canal.link || '';
                        cambiarCanal(streamUrl, canal.nombre, categoria);
                        searchInput.value = '';
                        searchSuggestions.classList.remove('active');
                        toggleChannels();
                        setTimeout(() => smoothScrollTo('player-container'), 300);
                    };
                    searchSuggestions.appendChild(suggestionItem);
                });
            } else {
                searchSuggestions.classList.remove('active');
            }
            
            // Resto de la función de búsqueda
            document.querySelectorAll('.channel-list').forEach(el => {
                el.style.display = 'none';
            });
            
            let resultadosEncontrados = false;
            
            Object.keys(todosCanales).forEach(categoria => {
                const canales = todosCanales[categoria];
                const resultados = canales.filter(canal => 
                    canal.nombre.toLowerCase().includes(termino) || 
                    categoria.toLowerCase().includes(termino)
                );
                
                if (resultados.length > 0) {
                    resultadosEncontrados = true;
                    const seccionId = `categoria-${categoria.replace(/\W+/g, '-').toLowerCase()}`;
                    let seccion = document.getElementById(seccionId);
                    
                    if (seccion) {
                        const grid = seccion.querySelector('.channel-grid');
                        grid.innerHTML = '';
                        
                        resultados.forEach(canal => {
                            const item = document.createElement('div');
                            item.className = 'channel-item';
                            
                            const logoSrc = canal.logo || canal['tvg-logo'] || '';
                            const channelId = `${categoria}-${canal.nombre}`;
                            const isFavorite = favorites[channelId] !== undefined;
                            
                            item.innerHTML = `
                                <div class="image-container">
                                    <img src="${logoSrc}" 
                                         alt="${canal.nombre}" 
                                         onerror="handleImageError(this)">
                                    <div class="favorite-icon ${isFavorite ? 'active' : ''}" onclick="toggleFavorite('${canal.nombre}', '${categoria}', event)">
                                        <i class="fas fa-heart"></i>
                                    </div>
                                </div>
                                <div class="channel-name">${canal.nombre}</div>
                                <div class="channel-description">${categoria}</div>
                            `;
                            
                            const streamUrl = canal.url || canal.link || '';
                            item.onclick = () => {
                                cambiarCanal(streamUrl, canal.nombre, categoria, logoSrc);
                                toggleChannels();
                                
                                setTimeout(() => {
                                    smoothScrollTo('player-container');
                                }, 300);
                            };
                            grid.appendChild(item);
                        });
                        
                        seccion.style.display = 'block';
                    }
                }
            });
            
            document.getElementById('no-results').style.display = resultadosEncontrados ? 'none' : 'block';
            
            if (resultadosEncontrados) {
                setTimeout(() => {
                    smoothScrollTo('channels-container');
                }, 100);
            }
        });
        
        // Cerrar sugerencias al hacer clic fuera
        document.addEventListener('click', (e) => {
            if (!searchInput.contains(e.target) && !searchSuggestions.contains(e.target)) {
                searchSuggestions.classList.remove('active');
            }
        });
    }

    function mostrarLoading(mostrar) {
        const loading = document.getElementById('loading');
        if (loading) loading.style.display = mostrar ? 'flex' : 'none';
    }

    function mostrarError(mensaje) {
        const errorDiv = document.getElementById('error-message');
        if (errorDiv) {
            errorDiv.textContent = mensaje;
            errorDiv.style.display = 'flex';
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }
    }
    
    function tryReconnect(videoUrl, channelName, channelDescription) {
        if (retryCount < MAX_RETRIES) {
            retryCount++;
            mostrarError(`Error de conexión. Reintentando... (${retryCount}/${MAX_RETRIES})`);
            
            setTimeout(() => {
                cambiarCanal(videoUrl, channelName, channelDescription);
            }, 3000);
        } else {
            mostrarError('No se pudo conectar al canal después de varios intentos, Recarga el reproductor y/o Cambia El Canal.');
            retryCount = 0;
        }
    }

    function setupFloatingButton() {
        const floatingButton = document.getElementById('back-to-player');
        window.addEventListener('scroll', () => {
            if (window.scrollY > 300) {
                floatingButton.classList.add('visible');
            } else {
                floatingButton.classList.remove('visible');
            }
        });
        
        floatingButton.addEventListener('click', () => {
            smoothScrollTo('player-container');
        });
    }

    function setupHeaderSearch() {
        const searchToggle = document.getElementById('search-toggle');
        const searchForm = document.getElementById('header-search-form');
        const searchInput = document.getElementById('header-search-input');
        const searchClose = document.getElementById('header-search-close');
        
        searchToggle.addEventListener('click', () => {
            searchForm.classList.toggle('active');
            if (searchForm.classList.contains('active')) {
                searchInput.focus();
            }
        });
        
        searchClose.addEventListener('click', () => {
            searchForm.classList.remove('active');
            searchInput.value = '';
            
            if (showingFavorites) {
                mostrarFavoritos();
            } else {
                Object.keys(todosCanales).forEach(categoria => {
                    const seccion = document.getElementById(`categoria-${categoria.replace(/\W+/g, '-').toLowerCase()}`);
                    if (seccion) seccion.style.display = 'block';
                });
            }
            document.getElementById('no-results').style.display = 'none';
        });
        
        document.addEventListener('click', (e) => {
            if (!searchForm.contains(e.target) && e.target !== searchToggle) {
                searchForm.classList.remove('active');
            }
        });
    }

    // Configurar el tema
    function setupTheme() {
        const themeToggle = document.getElementById('theme-toggle');
        const icon = themeToggle.querySelector('i');
        
        // Cargar tema guardado
        const savedTheme = localStorage.getItem('theme') || 'dark';
        document.documentElement.setAttribute('data-theme', savedTheme);
        
        // Actualizar icono
        if (savedTheme === 'light') {
            icon.classList.remove('fa-moon');
            icon.classList.add('fa-sun');
        } else {
            icon.classList.remove('fa-sun');
            icon.classList.add('fa-moon');
        }
        
        // Alternar tema al hacer clic
        themeToggle.addEventListener('click', () => {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            
            if (newTheme === 'light') {
                icon.classList.remove('fa-moon');
                icon.classList.add('fa-sun');
            } else {
                icon.classList.remove('fa-sun');
                icon.classList.add('fa-moon');
            }
        });
    }

    // Configurar vista (cuadrícula/lista)
    function setupViewToggle() {
        const viewToggleButtons = document.querySelectorAll('.view-toggle-btn');
        
        // Establecer el botón activo según la preferencia guardada
        viewToggleButtons.forEach(btn => {
            if (btn.dataset.view === currentView) {
                btn.classList.add('active');
            } else {
                btn.classList.remove('active');
            }
            
            btn.addEventListener('click', () => {
                viewToggleButtons.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                currentView = btn.dataset.view;
                localStorage.setItem('viewPreference', currentView);
                
                // Aplicar la nueva vista a todas las secciones
                document.querySelectorAll('.channel-list').forEach(section => {
                    if (currentView === 'list') {
                        section.classList.add('list-view');
                    } else {
                        section.classList.remove('list-view');
                    }
                });
            });
        });
    }

    // Configurar botón de información deportiva
    function setupSportsInfoButton() {
        const sportsInfoBtn = document.getElementById('sports-info-btn');
        
        sportsInfoBtn.addEventListener('click', () => {
            // Aquí puedes redirigir a otra página o mostrar un modal con información
            window.open('https://www.espn.com.ar/', '_blank');
        });
    }

    // Registrar Service Worker
    async function registerServiceWorker() {
        if ('serviceWorker' in navigator) {
            try {
                const registration = await navigator.serviceWorker.register('/service-worker.js');
                console.log('Service Worker registrado con éxito:', registration);
                return registration;
            } catch (error) {
                console.error('Error registrando Service Worker:', error);
                return null;
            }
        }
        return null;
    }

    // Verificar si la PWA está instalada
    function checkIfAppIsInstalled() {
        if (window.matchMedia('(display-mode: standalone)').matches) {
            document.body.classList.add('pwa-installed');
            console.log('La aplicación está ejecutándose como PWA instalada');
        }
        
        window.matchMedia('(display-mode: standalone)').addListener((e) => {
            document.body.classList.toggle('pwa-installed', e.matches);
        });
    }

    // Manejar el evento de instalación
    function setupInstallPrompt() {
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            const installButton = document.getElementById('install-button');
            if (installButton) {
                installButton.style.display = 'block';
                
                installButton.addEventListener('click', async () => {
                    if (!deferredPrompt) return;
                    
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    
                    if (outcome === 'accepted') {
                        console.log('Usuario aceptó instalar la PWA');
                    } else {
                        console.log('Usuario rechazó instalar la PWA');
                    }
                    
                    deferredPrompt = null;
                    installButton.style.display = 'none';
                });
            }
        });
        
        window.addEventListener('appinstalled', () => {
            deferredPrompt = null;
            console.log('PWA instalada con éxito');
            
            const installButton = document.getElementById('install-button');
            if (installButton) {
                installButton.style.display = 'none';
            }
            
            document.body.classList.add('pwa-installed');
        });
    }

    // Verificar estado de conexión
    function setupOnlineOfflineDetection() {
        function updateOnlineStatus() {
            if (navigator.onLine) {
                document.body.classList.remove('offline');
                document.body.classList.add('online');
            } else {
                document.body.classList.remove('online');
                document.body.classList.add('offline');
                showOfflineMessage();
            }
        }
        
        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);
        updateOnlineStatus();
    }

    // Mostrar mensaje de offline
    function showOfflineMessage() {
        let offlineMessage = document.getElementById('offline-message');
        if (offlineMessage) {
            offlineMessage.style.display = 'block';
            
            if (navigator.onLine) {
                setTimeout(() => {
                    offlineMessage.style.display = 'none';
                }, 5000);
            }
        }
    }

    // Inicializar todas las funcionalidades PWA
    async function initPWA() {
        await registerServiceWorker();
        checkIfAppIsInstalled();
        setupInstallPrompt();
        setupOnlineOfflineDetection();
    }

    // Función para compartir canal
    function setupShareFunctionality() {
        const shareButton = document.getElementById('share-channel-btn');
        const shareModal = document.getElementById('share-modal');
        const shareUrlInput = document.getElementById('share-url');
        const copyShareUrlButton = document.getElementById('copy-share-url');
        const closeShareModal = document.getElementById('close-share-modal');
        const socialShareButtons = document.querySelectorAll('.social-share-btn');
        
        shareButton.addEventListener('click', () => {
            if (!currentChannel) {
                showToast('Selecciona un canal primero para compartir');
                return;
            }
            
            // Generar URL única para el canal
            const baseUrl = window.location.origin + window.location.pathname;
            const shareUrl = `${baseUrl}?channel=${encodeURIComponent(currentChannel.name)}&category=${encodeURIComponent(currentChannel.description)}`;
            
            shareUrlInput.value = shareUrl;
            shareModal.classList.add('active');
        });
        
        copyShareUrlButton.addEventListener('click', () => {
            shareUrlInput.select();
            document.execCommand('copy');
            showToast('Enlace copiado al portapapeles');
        });
        
        closeShareModal.addEventListener('click', () => {
            shareModal.classList.remove('active');
        });
        
        // Compartir en redes sociales
        socialShareButtons.forEach(button => {
            button.addEventListener('click', () => {
                const platform = button.dataset.platform;
                shareOnPlatform(platform, shareUrlInput.value, currentChannel.name);
            });
        });
        
        // Cerrar modal al hacer clic fuera
        shareModal.addEventListener('click', (e) => {
            if (e.target === shareModal) {
                shareModal.classList.remove('active');
            }
        });
    }

    // Función para compartir en plataformas específicas
    function shareOnPlatform(platform, url, channelName) {
        let shareUrl = '';
        
        switch(platform) {
            case 'whatsapp':
                shareUrl = `https://wa.me/?text=Mira ${encodeURIComponent(channelName)} en Maik Sport: ${encodeURIComponent(url)}`;
                break;
            case 'facebook':
                shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`;
                break;
            case 'twitter':
                shareUrl = `https://twitter.com/intent/tweet?text=Mira ${encodeURIComponent(channelName)} en Maik Sport&url=${encodeURIComponent(url)}`;
                break;
            case 'telegram':
                shareUrl = `https://t.me/share/url?url=${encodeURIComponent(url)}&text=Mira ${encodeURIComponent(channelName)} en Maik Sport`;
                break;
        }
        
        window.open(shareUrl, '_blank', 'width=600,height=400');
    }

    // Función para mostrar notificación toast
    function showToast(message) {
        let toast = document.getElementById('share-toast');
        if (!toast) {
            toast = document.createElement('div');
            toast.id = 'share-toast';
            toast.className = 'share-toast';
            document.body.appendChild(toast);
        }
        
        toast.textContent = message;
        toast.classList.add('show');
        
        setTimeout(() => {
            toast.classList.remove('show');
        }, 3000);
    }

    // Función para cargar canal desde URL
    function loadChannelFromURL() {
        const urlParams = new URLSearchParams(window.location.search);
        const channelName = urlParams.get('channel');
        const category = urlParams.get('category');
        
        if (channelName && category && todosCanales[category]) {
            const canal = todosCanales[category].find(c => c.nombre === channelName);
            if (canal) {
                cambiarCanal(canal.url, canal.nombre, category, canal.logo);
            }
        }
    }

    // Al cargar la página, guardar una copia de los canales en localStorage
    // para tener un respaldo en caso de que falle la carga en el futuro
    window.addEventListener('beforeunload', function() {
        if (Object.keys(todosCanales).length > 0) {
            localStorage.setItem('canalesBackup', JSON.stringify(todosCanales));
        }
    });

    // Añadir esta función para habilitar controles nativos
    function enableNativeControls() {
        const video = document.getElementById('video');
        if (!video) return;
        
        // Habilitar controles nativos en dispositivos móviles
        video.controls = true;
        
        // Asegurar que los controles sean visibles
        const style = document.createElement('style');
        style.innerHTML = `
            /* Mostrar controles nativos en todos los dispositivos */
            #video {
                -webkit-appearance: none;
                -moz-appearance: none;
                appearance: none;
            }
            
            #video::-webkit-media-controls-panel {
                display: flex !important;
                opacity: 1 !important;
            }
            
            #video::-webkit-media-controls-play-button,
            #video::-webkit-media-controls-volume-slider,
            #video::-webkit-media-controls-mute-button {
                display: flex !important;
            }
            
            /* Asegurar que los controles sean visibles en iOS */
            #video::-webkit-media-controls-enclosure {
                display: flex !important;
            }
        `;
        document.head.appendChild(style);
    }

    // Función debounce para optimizar eventos
    function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
            const later = () => {
                clearTimeout(timeout);
                func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    }

    // Inicializar la aplicación
    document.addEventListener('DOMContentLoaded', function() {
        cargarCanales();
        document.getElementById('toggle-channels-btn').addEventListener('click', toggleChannels);
        setupFloatingButton();
        setupHeaderSearch();
        setupTheme();
        setupViewToggle();
        setupSportsInfoButton();
        window.addEventListener('resize', debounce(adjustCategoryScroll, 250));
        
        // Nuevas inicializaciones
        setupShareFunctionality();
        loadChannelFromURL();
        
        // Inicializar funcionalidades PWA
        initPWA();

        // Configuración de controles de video
        disableSeekAndPauseControls();
        enableNativeControls();
        preventVideoPause();
        setupDoubleClickFullscreen();
        setupTouchGestures();
        
        // Configurar el nuevo botón de favoritos
        setupFavoritesToggle();
    });
// Resto del código JavaScript original...
// [Aquí iría todo el código JavaScript existente, pero sin las funciones que permiten controles del reproductor]

// Función para cargar canales (simplificada para el ejemplo)
function cargarCanales() {
    // Aquí iría la lógica para cargar los canales
    console.log('Cargando canales...');
}

// Función para cambiar canal (simplificada)
function cambiarCanal(url, nombre, categoria, logo) {
    console.log('Cambiando a canal:', nombre);
    currentChannel = { name: nombre, url: url, description: categoria, logo: logo };
    setupVideoControlPrevention(); // Asegurar que los controles estén deshabilitados
}

// Funciones de UI básicas
function toggleChannels() {
    const container = document.getElementById('channels-container');
    container.style.display = container.style.display === 'none' ? 'block' : 'none';
}

function toggleSearch() {
    const form = document.getElementById('header-search-form');
    form.classList.toggle('active');
}

function toggleTheme() {
    const currentTheme = document.documentElement.getAttribute('data-theme');
    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
    document.documentElement.setAttribute('data-theme', newTheme);
    localStorage.setItem('theme', newTheme);
    updateThemeIcon();
}

function updateThemeIcon() {
    const themeButton = document.querySelector('.theme-toggle i');
    const currentTheme = document.documentElement.getAttribute('data-theme');
    themeButton.className = currentTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
}

function toggleFavorites() {
    // Lógica para mostrar favoritos
}

function shareChannel() {
    // Lógica para compartir canal
}

function showPlaylistModal() {
    // Lógica para mostrar modal de playlist
}

function setViewMode(mode) {
    viewMode = mode;
    localStorage.setItem('viewMode', mode);
    
    // Actualizar botones
    document.getElementById('grid-view-btn').classList.toggle('active', mode === 'grid');
    document.getElementById('list-view-btn').classList.toggle('active', mode === 'list');
}

function setupDoubleClickFullscreen() {
    const videoPlayer = document.getElementById('video-player');
    if (!videoPlayer) return;

    videoPlayer.addEventListener('dblclick', () => {
        if (!document.fullscreenElement) {
            videoPlayer.requestFullscreen().catch(err => {
                console.error(`Error al activar pantalla completa: ${err.message}`);
            });
        } else {
            document.exitFullscreen();
        }
    });
}

function setupTouchGestures() {
    // Lógica para gestos táctiles sin permitir controles de video
}

function checkSavedPosition() {
    // Lógica para verificar posición guardada
}
</script>

</body>
</html>

